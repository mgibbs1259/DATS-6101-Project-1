---
title: "Project 1"
authors: Mary Gibbs and Rayhaan Rasheed
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

Project Overview
----------------

Data Source: https://www.kaggle.com/noriuk/us-educational-finances

Research Question: Is there a significant linear relationship between school expenditure and 4th and 8th grade average math scores from 2015 to 2015?
H0: B1 = 0 
HA: B1 != 0

Data Preparation
----------------

Packages
```{r}
library(data.table)
library(dplyr)
library(ggplot2)
library(ggvis)
library(grid)
library(plyr)
library(stats)
library(VIM)
```

Read in data
```{r}
finances <- fread("finances.csv")
scores <- fread("scores.csv")
```

Check data
```{r}
str(finances)
str(scores)
```

Clean data
```{r}
#choose columns of interest
finances <- finances[, c(1, 2, 4, 8)]
#select 2000 to 2015
finances <- finances[finances$YEAR > 2004 & finances$YEAR < 2016]
scores <- scores[scores$YEAR > 2004 & scores$YEAR < 2016]
#select mathematics
scores <- scores[scores$TEST_SUBJECT == 'Mathematics']
#join finances and scores on year and state
df <- merge(finances, scores, by = c("YEAR", "STATE"))
#make column names lowercase
df <- setnames(df, tolower(names(df)))
#remove rows with avg_score = "-" and avg_score = "‡"
df <- df[df$avg_score != "—" & df$avg_score != "‡"]
#change avg_score and test_year data types
df$avg_score <- as.numeric(df$avg_score, digits = 7)
df$test_year <- as.factor(df$test_year)
#check df 
str(df)
```

Exploratory Data Analysis
-------------------------

Summary
```{r}
#summarize df
summary(df)
```

Boxplot to check for outliers
```{r}
#divide graph area into two columns
par(mfrow = c(1, 2))  
#boxplot total expenditure and average math scores
boxplot(df$total_expenditure, main = "Total Expenditure")  
boxplot(df$avg_score, main = "Average Math Scores")
#toal expenditure has some outliers
#remove total expenditure outliers 
te_outliers <- boxplot(df$total_expenditure, plot = FALSE)$out
df <- df[!df$total_expenditure %in% te_outliers]
#boxplot of total expenditure (no outliers)
boxplot(df$total_expenditure, main = "Total Expenditure (No Outliers)")
```

Density plot to check normal distribution
```{r}
#divide graph area into two columns
par(mfrow = c(1, 2))  
#density plot total expenditure and average math scores
plot(density(df$total_expenditure), main = "Total Expenditure", ylab = "Frequency", col = "darkolivegreen3")
polygon(density(df$total_expenditure), col = "darkolivegreen3")
plot(density(df$avg_score), main = "Average Math Scores", ylab = "Frequency", col = "deepskyblue2")
polygon(density(df$avg_score), col = "deepskyblue2")
#total expenditure left skew
#average math scores bimodal
#check average math scores bimodal due to grade
df_4 <- df[df$test_year == 4]
df_8 <- df[df$test_year == 8]
#divide graph area into two columns
par(mfrow = c(1, 2))  
#density plot 4th grade average math scores and 8th grade average math scores
plot(density(df_4$avg_score), main = "4th Grade Average Math Scores", ylab = "Frequency", col = "indianred3")
polygon(density(df_4$avg_score), col = "indianred3")
plot(density(df_8$avg_score), main = "8th Grade Average Math Scores", ylab = "Frequency", col = "darkslateblue")
polygon(density(df_8$avg_score), col = "darkslateblue")
#average math scores bimodal due to grade
#treat 4th grade average math scores and 8th grade average math scores separate
```

Correlation 
```{r}
#correlation total expenditure and 4th grade average math scores
sprintf("total_expenditure_4 correlation: %f", cor(df_4$total_expenditure, df_4$avg_score))
#weak relationshup between total expenditure and 4th grade average math scores
#correlation total expenditure and 8th grade average math scores
sprintf("total_expenditure_8 correlation: %f", cor(df_8$total_expenditure, df_8$avg_score))
#weak relationship between total expenditure and 8th grade average math scores
```

Scatter plot 4th grade average math scores vs. total expenditure
```{r}
#scatter plot 4th grade average math scores vs. total expenditure
ggplot(df_4, aes(x = total_expenditure, y = avg_score)) +
      geom_point(shape = 1) +    
      geom_smooth(method = lm, se = FALSE, color = "indianred3") + 
      ggtitle("4th Grade Average Math Test Scores vs. Total Expenditure") + 
      theme(plot.title = element_text(hjust = 0.5)) + 
      xlab("Total Expenditure") + 
      ylab("Average Score")
```

Scatter plot 8th grade average math scores vs. total expenditure  
```{r}
#scatter plot 8th grade average math scores vs. total expenditure
ggplot(df_8, aes(x = total_expenditure, y = avg_score)) +
      geom_point(shape = 1) +    
      geom_smooth(method = lm, se = FALSE, color = "darkslateblue") + 
      ggtitle("8th Grade Average Math Test Scores vs. Total Expenditure") + 
      theme(plot.title = element_text(hjust = 0.5)) + 
      xlab("Total Expenditure") + 
      ylab("Average Score")
```

Models
------

Linear regression of 4th grade average math scores vs. total expenditure
```{r}
#linear regression 4th grade average math scores vs. total expenditure 
lm_df_4 <- lm(avg_score ~ total_expenditure, data = df_4)
summary(lm_df_4)
```

Linear regression of 8th grade average math scores vs. total expenditure
```{r}
#linear regression 8th grade average math test scores vs. total expenditure
lm_df_8 <- lm(avg_score ~ total_expenditure, data = df_8)
summary(lm_df_8)
```
